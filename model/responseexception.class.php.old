<?php
/**
 * Project: CleverPath Framework
 * IDE: JetBrains PhpStorm
 * Author: Ari Asulin
 * Email: ari.asulin@gmail.com
 * Date: 4/06/11 */
namespace CPath\Model;

use CPath\Base;
use CPath\Interfaces\IJSON;
use CPath\Interfaces\IResponse;
use CPath\Interfaces\IResponseAggregate;
use CPath\Interfaces\IResponseHelper;
use CPath\Interfaces\IXML;

class ResponseException extends \Exception implements IJSON, IXML, IResponseAggregate {
    private $mResponse;

    public function __construct($message=NULL, $code=NULL, $previous=NULL) {
        parent::__construct($message, $code, $previous);
        $this->mResponse = new Response($message, false, $this);
    }
    /**
     * @return Response
     */
    function getResponse() {
        return $this->mResponse;
    }


    function toJSON(Array &$JSON) {
        if(Config::$Debug) {
            $ex = $this->getPrevious() ?: $this;
            $trace = $ex->getTraceAsString();
            $JSON['_debug_trace'] = current(explode("\n", $trace));
        }
    }

    function toXML(\SimpleXMLElement $xml)
    {
        if(Config::$Debug) {
            $ex = $this->getPrevious() ?: $this;
            $trace = $ex->getTraceAsString();
            $xml->addChild('_debug_trace', current(explode("\n", $trace)));
        }
    }
}
